<!-- INCLUDE overall_header.html -->

<!-- INCLUDECSS @mundophpbb_stopbadbots/stopbadbots.css -->
<link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:wght@400;500;600;700&display=swap" rel="stylesheet">

<div class="stopbadbots-acp">
    <h1>{L_ACP_STOPBADBOTS_LOGS}</h1>
    <p>{L_BLOCK_LOG}</p>

    <!-- IF S_ERROR -->
    <div class="errorbox">
        <h3>{L_ERROR}</h3>
        <p>{ERROR_MESSAGE}</p>
    </div>
    <!-- ENDIF -->

    <!-- IF S_SUCCESS -->
    <div class="successbox">
        <h3>{L_SUCCESS}</h3>
        <p>{SUCCESS_MESSAGE}</p>
    </div>
    <!-- ENDIF -->

    <form id="sbb_log_search" method="post" action="{U_ACTION}">
        <fieldset>
            <div class="search-box submit-buttons">
                <div>
                    <label for="log_search">{L_SEARCH_LOGS}:</label>
                    <input type="text" id="log_search" name="log_search" value="{LOG_SEARCH}" placeholder="{L_SEARCH_LOGS_PLACEHOLDER}" class="inputbox" aria-label="{L_SEARCH_LOGS}" />
                </div>
                <div>
                    <label for="log_date_from">{L_DATE_FROM}:</label>
                    <input type="date" id="log_date_from" name="log_date_from" value="{LOG_DATE_FROM}" class="inputbox" aria-label="{L_DATE_FROM}" />
                </div>
                <div>
                    <label for="log_date_to">{L_DATE_TO}:</label>
                    <input type="date" id="log_date_to" name="log_date_to" value="{LOG_DATE_TO}" class="inputbox" aria-label="{L_DATE_TO}" />
                </div>
                <div>
                    <label for="log_reason">{L_REASON}:</label>
                    <select id="log_reason" name="log_reason" class="inputbox" aria-label="{L_REASON}">
                        <option value="">{L_ALL}</option>
                        <option value="User-Agent" <!-- IF LOG_REASON == "User-Agent" -->selected="selected"<!-- ENDIF -->>{L_USER_AGENT}</option>
                        <option value="IP" <!-- IF LOG_REASON == "IP" -->selected="selected"<!-- ENDIF -->>{L_IP}</option>
                        <option value="Referer" <!-- IF LOG_REASON == "Referer" -->selected="selected"<!-- ENDIF -->>{L_REFERER}</option>
                    </select>
                </div>
                <div class="submit-buttons">
                    <input type="submit" name="submit_search" value="{L_S_SUBMIT}" class="button" aria-label="{L_S_SUBMIT}" />
                    <input type="submit" name="clear_search" value="{L_CLEAR_SEARCH}" class="button remove" aria-label="{L_CLEAR_SEARCH}" />
                </div>
            </div>
            {S_FORM_TOKEN}
        </fieldset>
    </form>

    <!-- IF .log_entries -->
    <div class="submit-buttons">
        <form id="sbb_clear_logs" method="post" action="{U_CLEAR_LOG}">
            <input type="hidden" name="action" value="clear_log" />
            <input type="submit" name="submit" class="button remove" value="{L_CONFIRM_CLEAR_LOG}" onclick="return confirm('{L_CONFIRM_CLEAR_LOG_MESSAGE}');" aria-label="{L_CONFIRM_CLEAR_LOG}" />
            {S_FORM_TOKEN}
        </form>
        <form id="sbb_export_logs" method="post" action="{U_EXPORT_CSV}">
            <input type="hidden" name="action" value="export_csv" />
            <input type="submit" name="submit" class="button" value="{L_EXPORT_LOGS}" onclick="return confirm('{L_CONFIRM_EXPORT_LOGS_MESSAGE}');" aria-label="{L_EXPORT_LOGS}" />
            {S_FORM_TOKEN}
        </form>
    </div>
    <!-- ENDIF -->

    <!-- IF TOTAL_LOGS > 0 -->
    <div style="text-align: center; margin-bottom: 10px;">
        {L_TOTAL_LOGS}: {TOTAL_LOGS} | {L_PAGE_NUMBER}: {PAGE_NUMBER}
        <!-- BEGIN pagination -->
        {pagination.PAGINATION}
        <!-- END pagination -->
    </div>
    <!-- ENDIF -->

    <div class="scrollable-table">
        <table class="table1 zebra-table" aria-label="{L_ACP_STOPBADBOTS_LOGS}">
            <thead>
                <tr>
                    <th scope="col">{L_LOG_TIME}</th>
                    <th scope="col">{L_USER_AGENT}</th>
                    <th scope="col">{L_IP}</th>
                    <th scope="col">{L_REFERER}</th>
                    <th scope="col">{L_REASON}</th>
                </tr>
            </thead>
            <tbody>
                <!-- BEGIN log_entries -->
                <tr>
                    <td>{log_entries.LOG_TIME}</td>
                    <td>{log_entries.USER_AGENT}</td>
                    <td>{log_entries.IP}</td>
                    <td>{log_entries.REFERER}</td>
                    <td>{log_entries.REASON}</td>
                </tr>
                <!-- ELSE -->
                <tr>
                    <td colspan="5" style="text-align: center;">{L_NO_LOG_ENTRIES}</td>
                </tr>
                <!-- END log_entries -->
            </tbody>
        </table>
    </div>

    <!-- IF TOTAL_LOGS > 0 -->
    <div style="text-align: center; margin-top: 10px;">
        {L_TOTAL_LOGS}: {TOTAL_LOGS} | {L_PAGE_NUMBER}: {PAGE_NUMBER}
        <!-- BEGIN pagination -->
        {pagination.PAGINATION}
        <!-- END pagination -->
    </div>
    <!-- ENDIF -->
</div>

<script>
function toggleSectionCheckboxes(source) {
    var table = source.closest('table');
    var checkboxes = table.querySelectorAll('input[name="delete_ids[]"]');
    for (var i = 0; i < checkboxes.length; i++) {
        checkboxes[i].checked = source.checked;
    }
}

function validateMassDeleteForm() {
    var checkboxes = document.querySelectorAll('input[name="delete_ids[]"]:checked');
    if (checkboxes.length === 0) {
        alert('{L_NO_ENTRIES_SELECTED}');
        return false;
    }
    return true;
}

document.addEventListener('DOMContentLoaded', function() {
    var uploadForm = document.getElementById('upload_list_form');
    if (uploadForm) {
        uploadForm.addEventListener('submit', function() {
            document.getElementById('upload_submit').disabled = true;
            document.getElementById('upload_progress').style.display = 'inline';
        });
    }

    var importForm = document.getElementById('import_default_lists_form');
    if (importForm) {
        importForm.addEventListener('submit', function(e) {
            e.preventDefault();
            document.getElementById('import_submit').disabled = true;
            document.getElementById('import_progress').style.display = 'inline';
            fetch('{U_ACTION}&action=import_default_lists', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: 'submit=1&{S_FORM_TOKEN}'
            })
            .then(response => {
                console.log('Import response status: ' + response.status);
                if (!response.ok) {
                    throw new Error('Erro na resposta da rede: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Import data received: ', data);
                document.getElementById('import_submit').disabled = false;
                document.getElementById('import_progress').style.display = 'none';
                if (data.success) {
                    alert(data.message);
                    window.location.href = '{U_ACTION}';
                } else {
                    console.error('Import error: ' + (data.message || '{L_IMPORT_FROM_TXT_FILES_FAILED}'));
                    alert(data.message || '{L_IMPORT_FROM_TXT_FILES_FAILED}');
                }
            })
            .catch(error => {
                document.getElementById('import_submit').disabled = false;
                document.getElementById('import_progress').style.display = 'none';
                console.error('Import fetch error: ', error);
                alert('{L_IMPORT_FROM_TXT_FILES_FAILED}: ' + error.message);
            });
        });
    }
});
</script>

<!-- INCLUDE overall_footer.html -->