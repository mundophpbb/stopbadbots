<!-- INCLUDE overall_header.html -->
<!-- INCLUDECSS @mundophpbb_stopbadbots/stopbadbots.css -->
<link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:wght@400;500;600;700&display=swap" rel="stylesheet">
<div class="stopbadbots-acp">
    <h1>{L_ACP_STOPBADBOTS_LISTS}</h1>
    <p>{L_ACP_STOPBADBOTS_UPDATE_NOTICE}</p>
    <!-- IF S_ERROR -->
    <div class="errorbox">
        <h3>{L_ERROR}</h3>
        <p>{ERROR_MESSAGE}</p>
    </div>
    <!-- ENDIF -->
    <!-- IF S_CONFIRM_ACTION -->
    <!-- INCLUDE confirm_body.html -->
    <!-- ELSE -->
    <fieldset>
        <!-- Formulário de busca -->
        <form id="search_list_form" method="post" action="{U_ACTION}">
            <dl>
                <dt><label for="list_search">{L_SEARCH_LIST}:</label></dt>
                <dd>
                    <div class="submit-buttons">
                        <input type="text" id="list_search" name="list_search" value="{LIST_SEARCH}" class="inputbox" placeholder="{L_SEARCH_LIST_PLACEHOLDER}" aria-describedby="search_list_explain" />
                        <input type="submit" name="submit_search" value="{L_SUBMIT}" class="button" aria-label="{L_SUBMIT}" />
                        <input type="submit" name="clear_search" value="{L_CLEAR_SEARCH}" class="button remove" onclick="document.getElementById('list_search').value = '';" aria-label="{L_CLEAR_SEARCH}" />
                    </div>
                </dd>
            </dl>
            {S_FORM_TOKEN}
        </form>
        <!-- Formulário para adicionar User-Agent (Blacklist) -->
        <form id="add_user_agent_form" method="post" action="{U_ACTION}&action=add_user_agent">
            <dl>
                <dt><label for="new_user_agent">{L_NEW_USER_AGENT}:</label></dt>
                <dd>
                    <div class="submit-buttons">
                        <input type="text" id="new_user_agent" name="new_user_agent" value="" class="inputbox" aria-describedby="new_user_agent_explain" />
                        <input type="submit" name="submit" value="{L_SUBMIT}" class="button" aria-label="{L_SUBMIT}" />
                    </div>
                </dd>
            </dl>
            {S_FORM_TOKEN}
        </form>
        <!-- Formulário para adicionar IP (Blacklist) -->
        <form id="add_ip_form" method="post" action="{U_ACTION}&action=add_ip">
            <dl>
                <dt><label for="new_ip_address">{L_NEW_IP_ADDRESS}:</label></dt>
                <dd>
                    <div class="submit-buttons">
                        <input type="text" id="new_ip_address" name="new_ip_address" value="" class="inputbox" aria-describedby="new_ip_address_explain" />
                        <input type="submit" name="submit" value="{L_SUBMIT}" class="button" aria-label="{L_SUBMIT}" />
                    </div>
                </dd>
            </dl>
            {S_FORM_TOKEN}
        </form>
        <!-- Formulário para adicionar Referer (Blacklist) -->
        <form id="add_referer_form" method="post" action="{U_ACTION}&action=add_referer">
            <dl>
                <dt><label for="new_referer">{L_NEW_REFERER}:</label></dt>
                <dd>
                    <div class="submit-buttons">
                        <input type="text" id="new_referer" name="new_referer" value="" class="inputbox" aria-describedby="new_referer_explain" />
                        <input type="submit" name="submit" value="{L_SUBMIT}" class="button" aria-label="{L_SUBMIT}" />
                    </div>
                </dd>
            </dl>
            {S_FORM_TOKEN}
        </form>
        <!-- Formulário para adicionar User-Agent (Whitelist) -->
        <form id="add_ua_whitelist_form" method="post" action="{U_ACTION}&action=add_ua_whitelist">
            <dl>
                <dt><label for="new_ua_whitelist">{L_NEW_UA_WHITELIST}:</label></dt>
                <dd>
                    <div class="submit-buttons">
                        <input type="text" id="new_ua_whitelist" name="new_ua_whitelist" value="" class="inputbox" aria-describedby="new_ua_whitelist_explain" />
                        <input type="submit" name="submit" value="{L_SUBMIT}" class="button" aria-label="{L_SUBMIT}" />
                    </div>
                </dd>
            </dl>
            {S_FORM_TOKEN}
        </form>
        <!-- Formulário para adicionar IP (Whitelist) -->
        <form id="add_ip_whitelist_form" method="post" action="{U_ACTION}&action=add_ip_whitelist">
            <dl>
                <dt><label for="new_ip_whitelist">{L_NEW_IP_WHITELIST}:</label></dt>
                <dd>
                    <div class="submit-buttons">
                        <input type="text" id="new_ip_whitelist" name="new_ip_whitelist" value="" class="inputbox" aria-describedby="new_ip_whitelist_explain" />
                        <input type="submit" name="submit" value="{L_SUBMIT}" class="button" aria-label="{L_SUBMIT}" />
                    </div>
                </dd>
            </dl>
            {S_FORM_TOKEN}
        </form>
        <!-- Formulário para adicionar Referer (Whitelist) -->
        <form id="add_ref_whitelist_form" method="post" action="{U_ACTION}&action=add_ref_whitelist">
            <dl>
                <dt><label for="new_ref_whitelist">{L_NEW_REF_WHITELIST}:</label></dt>
                <dd>
                    <div class="submit-buttons">
                        <input type="text" id="new_ref_whitelist" name="new_ref_whitelist" value="" class="inputbox" aria-describedby="new_ref_whitelist_explain" />
                        <input type="submit" name="submit" value="{L_SUBMIT}" class="button" aria-label="{L_SUBMIT}" />
                    </div>
                </dd>
            </dl>
            {S_FORM_TOKEN}
        </form>
        <!-- Formulário para upload de arquivo .txt ou .csv -->
        <form id="upload_list_form" method="post" action="{U_ACTION}&action=upload_list" enctype="multipart/form-data">
            <dl>
                <dt>
                    <label for="list_type">{L_UPLOAD_LIST_TYPE}:</label><br />
                    <span id="upload_list_type_explain">{L_UPLOAD_LIST_TYPE_EXPLAIN}</span>
                </dt>
                <dd>
                    <div class="submit-buttons">
                        <select id="list_type" name="list_type" class="inputbox" aria-describedby="upload_list_type_explain">
                            <option value="ua_blacklist">{L_USER_AGENT_LIST}</option>
                            <option value="ip_blacklist">{L_IP_ADDRESS_LIST}</option>
                            <option value="ref_blacklist">{L_REFERER_LIST}</option>
                            <option value="ua_whitelist">{L_ACP_STOPBADBOTS_UA_WHITELIST}</option>
                            <option value="ip_whitelist">{L_ACP_STOPBADBOTS_IP_WHITELIST}</option>
                            <option value="ref_whitelist">{L_ACP_STOPBADBOTS_REF_WHITELIST}</option>
                        </select>
                        <label class="file-upload">
                            <input type="file" id="list_file" name="list_file" accept=".txt,.csv" class="file-input" aria-describedby="upload_list_file_explain" />
                            <span class="button">{L_CHOOSE_FILE}</span>
                        </label>
                        <input type="submit" name="submit" value="{L_UPLOAD}" class="button" id="upload_submit" aria-label="{L_UPLOAD}" />
                        <span id="upload_progress" style="display: none;">{L_UPLOADING}...</span>
                    </div>
                </dd>
            </dl>
            {S_FORM_TOKEN}
        </form>
        <!-- Formulário para importar das listas padrão -->
        <form id="import_default_lists_form" method="post" action="{U_ACTION}&action=import_default_lists">
            <div class="submit-buttons import-buttons">
                <input type="submit" name="submit" value="{L_IMPORT_FROM_TXT_FILES}" class="button" id="import_submit" aria-label="{L_IMPORT_FROM_TXT_FILES}" />
                <span id="import_progress" style="display: none;">{L_IMPORTING}...</span>
                {S_FORM_TOKEN}
            </div>
        </form>
    </fieldset>
    <form id="mass_delete_form" method="post" action="{U_ACTION}&action=mass_delete" onsubmit="return validateMassDeleteForm();">
        <div class="panel">
            <div class="inner">
                <h3>{L_SEARCH_RESULTS} ({SEARCH_RESULT_COUNT})</h3>
                <!-- IF LIST_SEARCH -->
                <div class="scrollable-table">
                    <table class="table1" cellspacing="1" aria-label="{L_SEARCH_RESULTS}" aria-describedby="search_results_explain">
                        <thead>
                            <tr>
                                <th><input type="checkbox" onclick="toggleSectionCheckboxes(this)" aria-label="{L_SELECT_ALL}" /></th>
                                <th>{L_LIST_TYPE}</th>
                                <th>{L_VALUE}</th>
                                <th>{L_ADDED_TIME}</th>
                                <th>{L_OPTIONS}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- BEGIN search_results -->
                            <tr class="bg1">
                                <td><input type="checkbox" name="delete_ids[]" value="{search_results.ID}" aria-label="{L_SELECT_ENTRY}" /></td>
                                <td>{search_results.LIST_TYPE}</td>
                                <td>{search_results.VALUE}</td>
                                <td>{search_results.ADDED_TIME}</td>
                                <td>
                                    <a href="{search_results.U_DELETE}" data-ajax="row_delete" data-confirm-message="{L_CONFIRM_DELETE_LIST}" class="button remove" aria-label="{L_DELETE}">{L_DELETE}</a>
                                </td>
                            </tr>
                            <!-- ELSE -->
                            <tr>
                                <td colspan="5">{L_NO_SEARCH_RESULTS}</td>
                            </tr>
                            <!-- END search_results -->
                        </tbody>
                    </table>
                </div>
                <!-- ELSE -->
                <p>{L_NO_SEARCH_PERFORMED}</p>
                <!-- ENDIF -->
                <div class="submit-buttons">
                    <input type="submit" name="submit" value="{L_DELETE_SELECTED}" class="button" aria-label="{L_DELETE_SELECTED}" />
                </div>
                {S_FORM_TOKEN}
            </div>
        </div>
    </form>
    <!-- ENDIF -->
</div>
<script>
function toggleSectionCheckboxes(source) {
    var table = source.closest('table');
    var checkboxes = table.querySelectorAll('input[name="delete_ids[]"]');
    for (var i = 0; i < checkboxes.length; i++) {
        checkboxes[i].checked = source.checked;
    }
}
function validateMassDeleteForm() {
    var checkboxes = document.querySelectorAll('input[name="delete_ids[]"]:checked');
    if (checkboxes.length === 0) {
        alert('{L_NO_ENTRIES_SELECTED}');
        return false;
    }
    return true;
}
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('upload_list_form').addEventListener('submit', function() {
        document.getElementById('upload_submit').disabled = true;
        document.getElementById('upload_progress').style.display = 'inline';
    });
    document.getElementById('import_default_lists_form').addEventListener('submit', function(e) {
        e.preventDefault();
        document.getElementById('import_submit').disabled = true;
        document.getElementById('import_progress').style.display = 'inline';
        fetch('{U_ACTION}&action=import_default_lists', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: 'submit=1&{S_FORM_TOKEN}'
        })
        .then(response => {
            console.log('Import response status: ' + response.status);
            if (!response.ok) {
                throw new Error('Erro na resposta da rede: ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log('Import data received: ', data);
            document.getElementById('import_submit').disabled = false;
            document.getElementById('import_progress').style.display = 'none';
            if (data.success) {
                alert(data.message);
                window.location.href = '{U_ACTION}';
            } else {
                console.error('Import error: ' + (data.message || '{L_IMPORT_FROM_TXT_FILES_FAILED}'));
                alert(data.message || '{L_IMPORT_FROM_TXT_FILES_FAILED}');
            }
        })
        .catch(error => {
            document.getElementById('import_submit').disabled = false;
            document.getElementById('import_progress').style.display = 'none';
            console.error('Import fetch error: ', error);
            alert('{L_IMPORT_FROM_TXT_FILES_FAILED}: ' + error.message);
        });
    });
});
</script>
<!-- INCLUDE overall_footer.html -->